function I(d,e,t){return{h:d,s:e,l:t,lighten:s=>I(d,e,t+s),darken:s=>I(d,e,t-s),toString:()=>`hsl(${d}, ${e}%, ${t}%)`}}function C(d){let e=0,t=0,s=0;d.length==4?(e="0x"+d[1]+d[1],t="0x"+d[2]+d[2],s="0x"+d[3]+d[3]):d.length==7&&(e="0x"+d[1]+d[2],t="0x"+d[3]+d[4],s="0x"+d[5]+d[6]),e/=255,t/=255,s/=255;let i=Math.min(e,t,s),r=Math.max(e,t,s),n=r-i,a=0,c=0,o=0;return n==0?a=0:r==e?a=(t-s)/n%6:r==t?a=(s-e)/n+2:a=(e-t)/n+4,a=Math.round(a*60),a<0&&(a+=360),o=(r+i)/2,c=n==0?0:n/(1-Math.abs(2*o-1)),c=+(c*100).toFixed(1),o=+(o*100).toFixed(1),I(a,c,o)}function A(){document.body.classList.add("light-mode"),D(0,"#fff")}function D(d,e){const t=C(e),s={body:{"background-color":["#fff",t.lighten(15)]},".innercont":{color:["#222c36",t.lighten(85)]},".topBar, .bottomBar, .footer":{"border-color":["#f1f1f1",t.lighten(6)]},".topBar, .bottomBar":{"background-color":["#fff",t.lighten(10)]},".footer":{"background-color":["#fcfcfc",t.lighten(10)]}};Object.entries(s).forEach(([i,r])=>{document.querySelectorAll(i).forEach(n=>{Object.entries(s[i]).forEach(([a,c])=>{n.style[a]=c[d]})})})}var L,l,M=[].indexOf,h=function(d,e){if(!(d instanceof e))throw new Error("Bound instance method accessed before binding")};L=(function(){class d{constructor(){this.log=this.log.bind(this)}postMessage(){var t,s,i;return t=Array.prototype.slice.call(arguments),s=t.shift(),i=t,window.parent.postMessage([this.CODENAME,s,i],"*")}setStyles(t,s){var i,r;r=[];for(i in s)r.push(t.style[i]=s[i]);return r}log(){if(this.options.debug)return console.log("[Headway Debug]",arguments)}diff(t,s){return t.filter(function(i){return M.call(s,i)<0})}}return d.prototype.CODENAME="CaptainAmerica",d}).call(globalThis);l=window.App=class extends L{constructor(e){super(),this.getChangelogs=this.getChangelogs.bind(this),this.getCategories=this.getCategories.bind(this),this.setupDefaults=this.setupDefaults.bind(this),this.removeOutlineOnClick=this.removeOutlineOnClick.bind(this),this.makeAccessible=this.makeAccessible.bind(this),this.makeInaccessible=this.makeInaccessible.bind(this),this.readMessage=this.readMessage.bind(this),this.wheneverOpened=this.wheneverOpened.bind(this),this.setBadge=this.setBadge.bind(this),this.wheneverClosed=this.wheneverClosed.bind(this),this.showIndex=this.showIndex.bind(this),this.showDetails=this.showDetails.bind(this),this.onceReady=this.onceReady.bind(this),this.migrateLocalStorage=this.migrateLocalStorage.bind(this),this.getCurrentIds=this.getCurrentIds.bind(this),this.refresh=this.refresh.bind(this),this.reload=this.reload.bind(this),this.badgeCount=this.badgeCount.bind(this),this.initState=this.initState.bind(this),this.setState=this.setState.bind(this),this.markItems=this.markItems.bind(this),this.markAllSeen=this.markAllSeen.bind(this),this.markRead=this.markRead.bind(this),this.markSeen=this.markSeen.bind(this),this.trackEvent=this.trackEvent.bind(this),this.serverStore=this.serverStore.bind(this),this.setListHeight=this.setListHeight.bind(this),this.setDetailsHeight=this.setDetailsHeight.bind(this),this.replaceBaseUrl=this.replaceBaseUrl.bind(this),this.applyTranslations=this.applyTranslations.bind(this),this.options=e,this.elements={logItems:document.querySelectorAll(".logItem"),backLinks:document.querySelectorAll(".back"),indexCont:document.getElementById("index"),logDetailsItem:document.querySelectorAll(".logDetailsItem"),innercont:document.querySelector(".innercont"),title:document.querySelector("h3"),readMore:document.querySelectorAll(".link a"),seeMore:document.querySelector(".footer a"),footer:document.querySelector(".footer")},this.current={data:null},this.setupDefaults(),A(),document.body.classList.add("right"),document.body.classList.add("bottom"),this.log("App.constructor",this.options,this.elements,this.current)}getChangelogs(){var e,t,s,i,r,n,a,c,o,u,g;if(h(this,l),this.changelogs)return this.changelogs;for(this.changelogs=[],o=this.elements.logItems,s=r=0,n=o.length;r<n;s=++r)g=o[s],i=parseInt(g.dataset.id),a=this.elements.logDetailsItem[s],c=a.querySelector(".content noscript"),t=c.textContent||c.innerHTML,e=[],this.getCategories(i).forEach(m=>e.push(m.name)),this.changelogs.push({id:i,title:(u=g.querySelector(".title"))!=null?u.innerText:void 0,categories:e,content:{short:g.querySelector(".short").innerHTML,long:t,more:!!a.querySelector("a.more")},dateTime:new Date(g.dataset.date),url:a.querySelector(".link a").href});return this.changelogs}getCategories(e){return h(this,l),window.categories[e]}setupDefaults(){var e,t,s,i,r,n,a,c;for(h(this,l),a=this.elements.logItems,e=t=0,i=a.length;t<i;e=++t)n=a[e],((o,u)=>{var g,m,f,p,b,k,S;return f=parseInt(o.dataset.id),g=this.getCategories(f),m={position:u+1,id:f,title:((b=o.querySelector(".title"))!=null?b.innerText.replace(/\.$/,""):void 0)||"",category:(k=g[0])!=null&&(S=k.name)!=null?S.toLowerCase():void 0,categories:g},p=this.elements.logDetailsItem[u].querySelector(".link a"),p!=null&&p.addEventListener("click",()=>this.postMessage("setAction",{event:"onReadMore",data:m})),this.removeOutlineOnClick(o),o.addEventListener("click",y=>(y.stopPropagation(),y.preventDefault(),this.showDetails(u),this.trackEvent("/r/read/"+this.accountId+"/"+o.dataset.id),this.markRead(o.dataset.id),this.postMessage("setAction",{event:"onShowDetails",data:m})))})(n,e);for(c=this.elements.backLinks,s=0,r=c.length;s<r;s++)n=c[s],this.removeOutlineOnClick(n),n.addEventListener("click",o=>(o.stopPropagation(),o.preventDefault(),this.showIndex()));if(this.elements.logItems.length>0)return window.addEventListener("message",o=>{var u,g,m,f;if(u=o.data,m=u[0],f=u[1],g=u[2],m===this.CODENAME)return this.readMessage(f,g)})}removeOutlineOnClick(e){return h(this,l),e.addEventListener("click",()=>e.classList.add("noOutline")),e.addEventListener("blur",()=>e.classList.remove("noOutline"))}makeAccessible(e){var t,s,i,r,n;for(h(this,l),e.removeAttribute("aria-hidden"),r=e.querySelectorAll("a"),n=[],t=0,s=r.length;t<s;t++)i=r[t],n.push(i.removeAttribute("tabindex"));return n}makeInaccessible(e){var t,s,i,r,n;for(h(this,l),e.setAttribute("aria-hidden","true"),r=e.querySelectorAll("a"),n=[],t=0,s=r.length;t<s;t++)i=r[t],n.push(i.setAttribute("tabindex","-1"));return n}readMessage(e,t){switch(h(this,l),e){case"opened":return this.wheneverOpened();case"closed":return this.wheneverClosed();case"ready":return this.onceReady(t[0]);case"markSeen":return this.markSeen(t[0]);case"markAllSeen":return this.markAllSeen();case"markRead":return this.markRead(t[0]);case"reload":return this.reload()}}wheneverOpened(){if(h(this,l),this.showIndex(),this.visible=!0,!this.options.embed)return this.markAllSeen(),this.trackEvent("/r/open/"+this.accountId)}setBadge(){return h(this,l),this.postMessage("setBadge",this.badgeCount())}wheneverClosed(){return h(this,l),this.visible=!1,setTimeout(this.showIndex,300)}showIndex(){var e,t,s,i,r;for(h(this,l),this.elements.innercont.classList.remove("detailsOpen"),this.setListHeight(),this.makeAccessible(this.elements.indexCont),i=this.elements.logDetailsItem,r=[],t=0,s=i.length;t<s;t++)e=i[t],r.push(this.makeInaccessible(e));return r}showDetails(e){var t,s,i,r;for(h(this,l),this.elements.innercont.classList.add("detailsOpen"),this.setDetailsHeight(e),this.makeInaccessible(this.elements.indexCont),r=this.elements.logDetailsItem,s=0,i=r.length;s<i;s++)t=r[s],this.makeInaccessible(t);return this.makeAccessible(this.elements.logDetailsItem[e])}onceReady(e){if(h(this,l),document.body.classList.remove("right","center","left","top","bottom"),e.newWidgetPositioning?(document.body.classList.add(e.position.x||"right"),document.body.classList.add(e.position.y||"bottom")):(document.body.classList.add("right"),document.body.classList.add("bottom")),this.options.embed=e.options.embed,this.options.debug=e.options.debug,this.options.baseUrl=e.options.baseUrl,this.token=e.options.token,this.current.data=e,this.localStorage=e.localStorage,this.accountId=e.options.account,this.applyTranslations(document.getElementById("index")),this.migrateLocalStorage())return this.initState(),this.markItems("read"),this.markItems("seen"),setTimeout(this.refresh,1*60*1e3),this.elements.seeMore!=null&&this.options.baseUrl&&(this.elements.seeMore.href=this.options.baseUrl),this.setListHeight(),this.postMessage("widgetReady",{options:this.options,changelogs:this.getChangelogs(),state:this.state,badgeCount:this.badgeCount()}),this.log("App.setupDefaults#ready",e)}migrateLocalStorage(){return h(this,l),this.options.activeStorage==="server"&&this.token!=null&&(this.localStorage.seen.length||this.localStorage.read.length)?(this.serverStore("/r/seen/"+this.accountId,"token="+this.token+"&seen="+this.localStorage.seen.join(","),()=>this.serverStore("/r/read/"+this.accountId,"token="+this.token+"&read="+this.localStorage.read.join(","),()=>this.postMessage("migrateLocalStorage"))),!1):!0}getCurrentIds(){var e,t,s,i,r;for(h(this,l),t=Array.prototype.slice.call(this.elements.logItems),r=[],s=0,i=t.length;s<i;s++)e=t[s],r.push(parseInt(e.dataset.id));return r}refresh(){if(h(this,l),this.options.autorefresh)return this.visible===!0?setTimeout(this.refresh,200):this.reload()}reload(){return h(this,l),document.location.reload()}badgeCount(){var e,t,s,i,r,n,a,c,o;if(h(this,l),this.options.activeStorage==="server"&&this.token==null)return 0;for(s=this.options.expireAfter||1/0,e=0,o=new Date().getTime(),c=document.querySelectorAll(".logItem"),n=0,a=c.length;n<a;n++)i=c[n],i.dataset.seen!=="true"&&(r=new Date(i.dataset.date).getTime(),t=Math.floor((o-r)/(1e3*3600*24)),!(t>=s)&&(e+=1));return e}initState(){return h(this,l),this.state=this.options.activeStorage==="server"?this.options.state||{read:[],seen:[]}:this.localStorage}setState(e,t){return h(this,l),this.state[e]=t,this.postMessage("setState",this.state),this.markItems(e),this.setBadge()}markItems(e){var t,s,i,r,n,a;if(h(this,l),s=this.state[e],s.length>0){for(a=[],r=0,n=s.length;r<n;r++)t=s[r],i=document.querySelector(`*[data-id='${t}']`),i?(i.dataset[e]=!0,a.push(i.classList.add(e))):a.push(void 0);return a}}markAllSeen(){var e,t;if(h(this,l),t=(function(){var s,i,r,n;for(r=this.getChangelogs().reverse(),n=[],s=0,i=r.length;s<i;s++)e=r[s],n.push(e.id);return n}).call(this),this.setState("seen",this.diff(this.state.seen,t).concat(t)),this.options.activeStorage==="server")return this.serverStore("/r/seen/"+this.accountId,"token="+this.token+"&seen="+t.join(","))}markRead(e){if(h(this,l),this.setState("read",this.diff(this.state.read,[e]).concat([e])),this.options.activeStorage==="server")return this.serverStore("/r/read/"+this.accountId,"token="+this.token+"&read="+e)}markSeen(e){if(h(this,l),this.setState("seen",this.diff(this.state.seen,[e]).concat([e])),this.options.activeStorage==="server")return this.serverStore("/r/seen/"+this.accountId,"token="+this.token+"&seen="+e)}trackEvent(e){if(h(this,l),this.options.track)return this.xhr(e)}serverStore(e,t="",s){if(h(this,l),!!this.token)return this.xhr(e,t,s)}xhr(e,t="",s){var i;return i=new XMLHttpRequest,i.open("POST",e),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.onreadystatechange=function(){if(this.readyState===4&&this.status===200&&s!=null)return s()},i.send(t)}setListHeight(){var e,t,s,i;return h(this,l),t=document.getElementById("index"),i=t.querySelector(".topBar").offsetHeight,s=t.querySelector(".logList").scrollHeight,e=t.querySelector(".footer").offsetHeight,this.postMessage("setHeight",{height:i+s+e})}setDetailsHeight(e){var t,s,i,r,n,a,c,o,u,g,m,f,p,b,k,S,y,v,w;for(h(this,l),b=this.elements.logDetailsItem,c=0,g=b.length;c<g;c++)a=b[c],this.setStyles(a,{display:"none"});if(i=this.elements.logDetailsItem[e].querySelector("noscript"),i){for(t=i.innerHTML,t=t.replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&amp;/g,"&"),v=i.parentNode,v.innerHTML=t,r=v.parentNode.querySelector(".logDetailsItem .link a").href,k=v.querySelectorAll("img"),o=0,m=k.length;o<m;o++)n=k[o],n.width>300&&n.classList.add("bigImage");for(S=v.querySelectorAll(".videoThumbWidth, .bigImage"),u=0,f=S.length;u<f;u++)p=S[u],p.addEventListener("click",()=>window.open(r));this.addTargetBlank(this.elements.logDetailsItem[e]),this.replaceBaseUrl(this.elements.logDetailsItem[e]),this.applyTranslations(v)}return this.setStyles(this.elements.logDetailsItem[e],{display:""}),w=this.elements.logDetailsItem[e].querySelector(".topBar").offsetHeight,y=this.elements.logDetailsItem[e].querySelector(".slideBody").scrollHeight,s=this.elements.logDetailsItem[e].querySelector(".bottomBar").offsetHeight,this.postMessage("setHeight",{height:w+y+s})}replaceBaseUrl(e){var t,s;if(h(this,l),s=e.querySelector(".link a"),this.options.baseUrl&&s!=null)return t=s.dataset.path,s.href=this.options.baseUrl+t}addTargetBlank(e){var t,s,i,r,n;for(r=e.querySelectorAll(".slideBody a"),n=[],t=0,s=r.length;t<s;t++)i=r[t],i.target="_blank",n.push(i.rel="noopener noreferrer");return n}applyTranslations(e){var t,s,i,r,n,a,c,o;if(h(this,l),(n=this.current.data)!=null&&n.options.translations&&(o=this.current.data.options.translations,o.title!=null&&(this.elements.title.textContent=o.title),o.footer!=null&&(r=document.createElement("a"),r.target="_blank",r.href=this.elements.seeMore.href,r.innerText=o.footer,this.elements.footer.innerHTML="",this.elements.footer.appendChild(r)),o.labels!=null&&e.querySelectorAll(".category").forEach(u=>{var g;if(g=o.labels[u.innerText.toLowerCase()],g)return u.innerText=g}),o.readMore!=null)){for(a=this.elements.readMore,c=[],s=0,i=a.length;s<i;s++)t=a[s],c.push(t.textContent=o.readMore);return c}}};
